# ฺฏุฒุงุฑุด ุชุญูู ุงููุช ู ูู ูพุฑูฺู (REV05)

**ุชุงุฑุฎ ฺฏุฒุงุฑุด:** {{DATE}}
**ุชูู ฺฉููุฏู:** ุฌููุฒ (Jules)
**ูุณุฎู ููุฑุฏ ุจุฑุฑุณ:** REV05

---

## ฑ. ููุฏูู ู ุฎูุงุตู ูุถุนุช
ูพุฑูฺู ุจุฑ ูพุงู ูุฑูโูุฑฺฉ **Laravel ูุณุฎู 9.2** ุชูุณุนู ุฏุงุฏู ุดุฏู ุงุณุช. ุงู ูุณุฎู ุงุฒ ูุงุฑุงูู ุจู ูพุงุงู ุนูุฑ ุฎูุฏ (EOL) ุฑุณุฏู ู ุฏฺฏุฑ ุจุฑูุฒุฑุณุงูโูุง ุงููุช ุฏุฑุงูุช ููโฺฉูุฏ ฺฉู ฺฉ ุฑุณฺฉ ุงููุช ูุญุณูุจ ูโุดูุฏ. ุณุงุฎุชุงุฑ ูพุฑูฺู ุจู ุตูุฑุช ูุงฺููุงุฑ (ุจุง ุงุณุชูุงุฏู ุงุฒ ูพฺฉุฌ `nwidart/laravel-modules`) ุทุฑุงุญ ุดุฏู ุงุณุช ฺฉู ุณุงุฒูุงูุฏู ุฎูุจ ุฏุงุฑุฏุ ุงูุง ุฏุฑ ูพุงุฏูโุณุงุฒ ููุทู ู ุงููุช ูุงฺููโูุง ุงุฑุงุฏุงุช ุฌุฏ ูุดุงูุฏู ุดุฏ.
ุจู ุฏูู ูุญุฏูุฏุชโูุง ูุญุทุ ุชุญูู ุจู ุตูุฑุช **Static Code Analysis** (ุชุญูู ุงุณุชุง ฺฉุฏ) ุงูุฌุงู ุดุฏู ุงุณุช.

---

## ฒ. ุชุญูู ุชุบุฑุงุช (Diff Analysis: REV04 vs REV05)
ุจุง ููุงุณู ูุณุฎู ูุนู (`REV05`) ุจุง ูุณุฎู ูุจู (`REV04`)ุ ุชุบุฑุงุช ุฒุฑ ูุดุงูุฏู ุดุฏ:
*   **ุญุฐู ูุณุฑูุง ูุงุงูู:** ูุณุฑ `/clear-cache` ฺฉู ุงุฌุงุฒู ูโุฏุงุฏ ูุฑ ฺฉุงุฑุจุฑ ฺฉุด ฺฉู ุณุฑูุฑ ุฑุง ูพุงฺฉ ฺฉูุฏ (ุขุณุจโูพุฐุฑ DoS)ุ ุฏุฑ ูุณุฎู ุฌุฏุฏ ุญุฐู ุดุฏู ุงุณุช. ุงู ฺฉ ุจูุจูุฏ ุงููุช ูุซุจุช ุงุณุช.
*   **ุญุฐู CKEditor Upload:** ูุณุฑ ุขูพููุฏ ูุงู ูุฑุจูุท ุจู CKEditor ูุฒ ุญุฐู ุดุฏู ุงุณุช ฺฉู ุงุญุชูุงูุงู ุจุฑุง ุฑูุน ุขุณุจโูพุฐุฑ ุขูพููุฏ ูุงู ุจูุฏู ุงุณุช.

---

## ณ. ุชุญูู ุฌุงูุน ุงููุช

### ๐ด ููุงุฑุฏ ุจุญุฑุงู (Critical)

#### ฑ. ุขุณุจโูพุฐุฑ ุขูพููุฏ ูุงู (File Upload RCE)
ุฏุฑ `FileLibraryController::upload` ู ุชูุงู ูุงฺููโูุง ฺฉู ุงุฒ ุขู ุงุณุชูุงุฏู ูโฺฉููุฏ (ูุงููุฏ ฺุช ูพุดุชุจุงูุ ุขูพููุฏ ูุฏุงุฑฺฉ ู ...)ุ ูฺ ุงุนุชุจุงุฑุณูุฌ ุฑู **ูพุณููุฏ ูุงู** ุงูุฌุงู ููโุดูุฏ.
*   **ูุญู ูููุน:** `Modules/FileLibrary/Http/Controllers/FileLibraryController.php`
*   **ุฑุณฺฉ:** ูฺฉุฑ ูโุชูุงูุฏ ฺฉ ูุงู ูุฎุฑุจ PHP (ูุซูุงู `shell.php`) ุขูพููุฏ ฺฉูุฏ. ุงุฒ ุขูุฌุง ฺฉู ูุงูโูุง ุฏุฑ ูพูุดู `public` ุฐุฎุฑู ูโุดููุฏุ ูฺฉุฑ ูโุชูุงูุฏ ุจุง ูุฑุงุฎูุงู ูุงู ุขูพููุฏ ุดุฏูุ ฺฉุฏ ูุฎุฑุจ ุฎูุฏ ุฑุง ุฑู ุณุฑูุฑ ุงุฌุฑุง ฺฉูุฏ ู ฺฉูุชุฑู ฺฉุงูู ุณุฑูุฑ ุฑุง ุจู ุฏุณุช ุจฺฏุฑุฏ.
*   **ุฑุงูฺฉุงุฑ:** ุญุชูุงู ุจุงุฏ ูุณุช ุณูุฏ (Allowlist) ุงุฒ ูพุณููุฏูุง ูุฌุงุฒ (ูุซู jpg, png, pdf, zip) ุชุนุฑู ุดูุฏ ู ุงุฒ ุขูพููุฏ ุณุงุฑ ูุงูโูุง ุฌููฺฏุฑ ฺฏุฑุฏุฏ.

#### ฒ. ุขุณุจโูพุฐุฑ ุงูุชุณุงุจ ุงูุจูู (Mass Assignment)
ุฏุฑ ุจุณุงุฑ ุงุฒ ูุฏูโูุง (Models)ุ ููุฏูุง ุญุณุงุณ ุฏุฑ ุขุฑุงู `$fillable` ูุฑุงุฑ ุฏุงุฏู ุดุฏูโุงูุฏ ู ุฏุฑ ฺฉูุชุฑูุฑูุง ุงุฒ `$request->all()` ุจุฑุง ุงุฌุงุฏ ุง ูุฑุงุด ุฑฺฉูุฑุฏ ุงุณุชูุงุฏู ุดุฏู ุงุณุช.
*   **ูุญู ูููุน:**
    *   `Modules/WorkPackageManager/Entities/WorkPackage.php`: ููุฏูุง `uid` (ูุงูฺฉ ูพุฑูฺู)ุ `status` (ูุถุนุช)ุ `published_at` ูุงุจู ูุฑุงุด ูุณุชูุฏ.
    *   `Modules/SupportSystem/Entities/SupportSystem.php`: ููุฏูุง `uid`, `status`, `created_by`.
    *   `Modules/Users/Entities/Users.php`: ููุฏ `role`, `password`.
*   **ุฑุณฺฉ:** ฺฉุงุฑุจุฑ ูโุชูุงูุฏ ุจุง ุงุฑุณุงู ูพุงุฑุงูุชุฑูุง ุงุถุงู ุฏุฑ ุฏุฑุฎูุงุณุช HTTPุ ูุถุนุช ูพุฑูฺู ุฑุง ุชุบุฑ ุฏูุฏุ ุฎูุฏ ุฑุง ูุฏุฑ ูพุฑูฺู ฺฉูุฏุ ุง ุจู ุฌุง ฺฉุงุฑุจุฑ ุฏฺฏุฑ ุชฺฉุช ุซุจุช ฺฉูุฏ.

#### ณ. ุจุงฺฏ ููุทู ุฎุทุฑูุงฺฉ ุฏุฑ ุญุฐู ูพุฑุฏุงุฎุชโูุง
ุฏุฑ ุจุฎุด ูุฏุฑุช ูพุฑุฏุงุฎุชโูุงุ ุฏฺฉูู ุญุฐู ุจู ุงุดุชุจุงู ุจู ูุณุฑ ุญุฐู ุชฺฉุชโูุง ูพุดุชุจุงู ูุฏุงุช ูโุดูุฏ.
*   **ูุญู ูููุน:** `Modules/Payment/Resources/views/index.blade.php` ู `Modules/SupportSystem/Http/Controllers/SupportSystemController.php`
*   **ุชูุถุญ:** ูุฑู ุญุฐู ุฏุฑ ูุณุช ูพุฑุฏุงุฎุชโูุง ุจู ุงฺฉุดู `dashboard/support/destroy` ูพุณุช ูโุดูุฏ. ุงู ุงฺฉุดู ุดูุงุณู (ID) ุฏุฑุงูุช ุฑุง ฺฏุฑูุชู ู ุชฺฉุช ูพุดุชุจุงู ุจุง ุขู ุดูุงุณู ุฑุง ุญุฐู ูโฺฉูุฏ!
*   **ุฑุณฺฉ:** ุชูุงุด ุจุฑุง ุญุฐู ฺฉ ุฑฺฉูุฑุฏ ูุงู ููุฌุฑ ุจู ุญุฐู ูุงุฎูุงุณุชู ุชฺฉุชโูุง ูพุดุชุจุงู ูโุดูุฏ ู ุฑฺฉูุฑุฏ ูุงู ุจุงู ูโูุงูุฏ.

### ๐ ููุงุฑุฏ ููู (High)

#### ด. ุถุนู ุฏุฑ ุงุญุฑุงุฒ ููุช (Authentication Weakness)
*   **ุชููุฏ ฺฉุฏ ุชุงุฏ:** ุงุฒ ุชุงุจุน `rand(10000, 99999)` ุงุณุชูุงุฏู ุดุฏู ฺฉู ุงุฒ ูุธุฑ ุฑูุฒูฺฏุงุฑ ุงูู ูุณุช.
*   **ุนุฏู ุงููุถุง ฺฉุฏ:** ุฏุฑ ูุชุฏ `verify` ุฏุฑ `UserController`ุ ูฺ ุจุฑุฑุณ ุจุฑุง ุฒูุงู ุงููุถุง ฺฉุฏ ุชุงุฏ (ูุซูุงู ฒ ุฏููู) ูุฌูุฏ ูุฏุงุฑุฏ. ฺฉุฏ ฺฉ ุจุงุฑ ุชููุฏ ุดุฏู ู ุชุง ุงุจุฏ (ุง ุชุง ุฏุฑุฎูุงุณุช ุจุนุฏ) ูุนุชุจุฑ ุงุณุช. ุงู ุงูฺฉุงู ุญููู Brute Force ุฑุง ูุฑุงูู ูโฺฉูุฏ.
*   **ุฎุฑูุฌ ฺฉุงุฑุจุฑ (Logout):** ุฏุฑ ูุชุฏ `logout`ุ ุฏุณุชูุฑ `Artisan::call('cache:clear')` ุงุฌุฑุง ูโุดูุฏ ฺฉู ฺฉุด ฺฉู ุณุฑูุฑ ุฑุง ูพุงฺฉ ูโฺฉูุฏ! ุงู ุจุงุนุซ ุงูุช ุดุฏุฏ ุณุฑุนุช ุณุณุชู ุจุง ูุฑ ุจุงุฑ ุฎุฑูุฌ ฺฉ ฺฉุงุฑุจุฑ ูโุดูุฏ ู ูโุชูุงูุฏ ุจู ุนููุงู ฺฉ ุญููู DoS ุงุณุชูุงุฏู ุดูุฏ.

#### ต. ูุฌูุฏ ุงุทูุงุนุงุช ุญุณุงุณ ุฏุฑ ฺฉุฏ (Hardcoded Secrets)
ูุงู `docker-compose.yml` ุญุงู ุฑูุฒ ุนุจูุฑ ุฏุชุงุจุณ (`secret`) ู ฺฉูุฏ ุงูพูฺฉุดู (`APP_KEY`) ุงุณุช. ุงฺฏุฑฺู ููฺฉู ุงุณุช ุงู ูุงู ุจุฑุง ุชูุณุนู ุจุงุดุฏุ ุงูุง ูุฌูุฏ ุขู ุฏุฑ ุฑูพุงุฒุชูุฑ ุฎุทุฑูุงฺฉ ุงุณุช.

---

## ด. ุชุญูู ููุทู ู ุณุงุฎุชุงุฑ

### ฑ. ุนุฏู ุงุนุชุจุงุฑุณูุฌ ููุงุณุจ (Validation)
ุฏุฑ ุจุณุงุฑ ุงุฒ ฺฉูุชุฑูุฑูุง (ูุซูุงู `PaymentController::update`)ุ ูุฑูุฏโูุง ุจุฏูู ุงุนุชุจุงุฑุณูุฌ ุงุณุชูุงุฏู ูโุดููุฏ.
ูุซุงู:
```php
if ($Payment->update(['status' => $request->status]))
```
ูฺ ฺฺฉ ููโุดูุฏ ฺฉู ุขุง `status` ุงุฑุณุงู ูุนุชุจุฑ ุงุณุช ุง ุฎุฑ.

### ฒ. ูุณุชูุฏุงุช (Documentation)
ูพุฑูฺู ูุงูุฏ ูุณุชูุฏุงุช ููุ ุฏุงฺฉูููุช API (Swagger) ู ุฑุงูููุง ุงุณุชูุฑุงุฑ ุงุณุช. ุชููุง ูุงู `README.md` ูพุดโูุฑุถ ูุงุฑุงูู ูุฌูุฏ ุฏุงุฑุฏ. ูุจูุฏ ุฏุงฺฉูููุช ุจุงุนุซ ุณุฎุช ูฺฏูุฏุงุฑ ู ุชูุณุนู ุขุช ูโุดูุฏ.

---

## ต. ฺฺฉโูุณุช ุงุตูุงุญุงุช ุจุฑุง ุชูุณุนูโุฏููุฏู

ุชูุณุนูโุฏููุฏู ููุธู ุงุณุช ููุงุฑุฏ ุฒุฑ ุฑุง ุจู ุชุฑุชุจ ุงูููุช ุงูุฌุงู ุฏูุฏ:

1.  [ ] **ุงุตูุงุญ ุขูพููุฏ ูุงู:** ูุญุฏูุฏ ฺฉุฑุฏู ูพุณููุฏูุง ูุฌุงุฒ ุฏุฑ `FileLibraryController` ุจู (jpg, jpeg, png, pdf, zip, rar) ู ุฌููฺฏุฑ ุงุฒ ุขูพููุฏ ูุงูโูุง ุงุฌุฑุง (php, exe, sh).
2.  [ ] **ุฑูุน ุจุงฺฏ ุญุฐู ูพุฑุฏุงุฎุช:** ุงุตูุงุญ `action` ูุฑู ุฏุฑ `Modules/Payment/Resources/views/index.blade.php` ุจู ูุณุฑ ุตุญุญ ุญุฐู ูพุฑุฏุงุฎุช.
3.  [ ] **ุงุตูุงุญ Mass Assignment:**
    *   ุญุฐู ููุฏูุง ุญุณุงุณ (`uid`, `role`, `status`, `created_by`, `password`) ุงุฒ `$fillable` ุฏุฑ ุชูุงู ูุฏูโูุง.
    *   ุงุณุชูุงุฏู ุงุฒ `$request->validated()` ุจู ุฌุง `$request->all()` ุฏุฑ ุชูุงู ฺฉูุชุฑูุฑูุง.
4.  [ ] **ุจูุจูุฏ ุงุญุฑุงุฒ ููุช:**
    *   ุงุณุชูุงุฏู ุงุฒ `random_int` ุจู ุฌุง `rand`.
    *   ุงูุฒูุฏู ุฒูุงู ุงููุถุง (ูุซูุงู ฑฒฐ ุซุงูู) ุจุฑุง ฺฉุฏูุง ุชุงุฏ ููุจุงู.
    *   ุญุฐู `Artisan::call` ูุง ูุฎุฑุจ ุงุฒ ูุชุฏ `logout`.
5.  [ ] **ุงุฑุชูุง ูุงุฑุงูู:** ุจุฑูุงูู ุฑุฒ ุจุฑุง ุงุฑุชูุง ุจู ุขุฎุฑู ูุณุฎู ูพุงุฏุงุฑ ูุงุฑุงูู (ูุณุฎู ฑฐ ุง ฑฑ).
6.  [ ] **ูุฏุฑุช Secrets:** ุญุฐู ุฑูุฒูุง ูุงุฑุฏฺฉุฏ ุดุฏู ุงุฒ ูุงูโูุง `docker-compose.yml` ู ุงุณุชูุงุฏู ุงุฒ `.env`.

---

ุงู ฺฏุฒุงุฑุด ุจุฑ ุงุณุงุณ ุชุญูู ูุณุฎู `REV05` ุชูู ุดุฏู ุงุณุช.
