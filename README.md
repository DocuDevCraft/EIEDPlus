# Jules Security & Code Review Standard Operating Procedure (SOP)

این سند راهنمای جامع و استاندارد برای هوش مصنوعی "جولز" (Jules) جهت بازبینی، تحلیل امنیتی و کنترل کیفیت پروژه‌های نرم‌افزاری است. این فایل باید در ریشه مخزن نگهداری شود و برای هر نسخه جدید (REVxx) به دقت اجرا گردد.

## هدف
هدف اطمینان از امنیت، کارایی، صحت منطقی و کیفیت کد در هر انتشار جدید است. جولز موظف است تمام جنبه‌های پروژه را اسکن کند، چیزی را از قلم نیندازد و تغییرات را نسبت به نسخه‌های قبل رصد کند.

---

## چک‌لیست اجرایی جولز (Jules Execution Checklist)

برای هر نسخه جدید (مثلاً `REV06`) مراحل زیر را به ترتیب انجام دهید:

### ۱. فاز راه‌اندازی و مقایسه (Setup & Differential Analysis)
1.  **شناسایی نسخه هدف:** آخرین پوشه `REVxx` را پیدا کنید.
2.  **مقایسه تغییرات (Trace Changes):**
    *   دستور `diff -qr REV(n-1) REV(n)` را اجرا کنید.
    *   فایل‌های تغییر یافته را لیست کنید.
    *   تحلیل کنید: آیا باگ‌های گزارش شده در نسخه قبل رفع شده‌اند؟ آیا کد جدید آسیب‌پذیری جدیدی ایجاد کرده است؟
3.  **بررسی گزارش قبلی (Regression Testing):**
    *   فایل `REPORT.md` نسخه قبلی را بخوانید.
    *   تک تک موارد "چک‌لیست توسعه‌دهنده" را بررسی کنید تا مطمئن شوید که رفع شده‌اند.
    *   اگر موردی رفع نشده بود، با تأکید بیشتر در گزارش جدید ذکر کنید.

### ۲. فاز اجرای آزمایشی (Execution & Dynamic Analysis)
سعی کنید پروژه را اجرا کنید تا تست‌های عملکردی انجام دهید.
1.  **تلاش با Docker:** دستور `docker-compose up` را امتحان کنید.
2.  **تلاش با PHP Built-in Server:** اگر داکر کار نکرد، وارد پوشه شوید و `php artisan serve` را اجرا کنید.
3.  **تست نفوذ اولیه (Basic Pentest):**
    *   اگر سرور بالا آمد، آدرس‌های حساس (مثل `/login`, `/admin`, `/upload`) را تست کنید.
    *   سعی کنید فایل مخرب آپلود کنید.
    *   سعی کنید با دستکاری URL به دیتای دیگران دسترسی پیدا کنید (IDOR).

### ۳. فاز اسکن جامع استاتیک (Deep Static Analysis)
حتی اگر پروژه اجرا نشد، کد را خط به خط اسکن کنید. **هیچ فایلی نباید نادیده گرفته شود.**

#### الف) اسکن امنیتی (Security Scan)
*   **Controller Analysis:** تمام کنترلرها را باز کنید.
    *   آیا `FileLibraryController::upload` یا متدهای مشابه برای آپلود فایل پسوند را چک می‌کنند؟ (فقط allowlist مجاز است).
    *   آیا از `$request->all()` در متدهای `create` یا `update` استفاده شده است؟ (خطر Mass Assignment).
    *   آیا ورودی‌های کاربر (`$request->input`) بدون اعتبارسنجی (Validation) استفاده شده‌اند؟
*   **Model Analysis:** تمام مدل‌ها را چک کنید.
    *   آیا فیلدهای حساس (`role`, `is_admin`, `status`, `uid`, `password`) در `$fillable` هستند؟
*   **Route Analysis:** فایل‌های `routes/web.php` و `routes/api.php` را چک کنید.
    *   آیا مسیر حساس بدون میدلور `auth` وجود دارد؟
    *   آیا مسیرهای دیباگ یا تست (مثل `clear-cache`, `test-email`) در کد باقی مانده‌اند؟
*   **View Analysis:** فایل‌های `blade` را چک کنید.
    *   آیا فرم‌ها به `action` درست اشاره می‌کنند؟ (چک کردن باگ Cross-Module مثل حذف پرداخت که به ساپورت می‌رفت).
    *   آیا خروجی‌های کاربر با `{!! !!}` چاپ شده‌اند؟ (خطر XSS).
*   **Config & Env:**
    *   آیا رمزهای عبور یا کلیدها در کد هاردکد شده‌اند؟ (`docker-compose.yml`, `config/*.php`).

#### ب) اسکن منطق و گردش کار (Logic & Workflow Check)
*   **سناریوهای بحرانی:** منطق بیزنس را دنبال کنید.
    *   **گردش پرداخت:** آیا بعد از پرداخت موفق، وضعیت سفارش درست آپدیت می‌شود؟ آیا کسی می‌تواند بدون پرداخت وضعیت را تغییر دهد؟
    *   **گردش دسترسی:** آیا کاربر معمولی می‌تواند به پنل مدیریت دسترسی پیدا کند؟ (چک کردن `Gate`, `Middleware`).
    *   **تخریب داده:** آیا عملیاتی وجود دارد که دیتای زیادی را پاک کند؟ (مثل `cache:clear` در لاگ‌اوت).

### ۴. فاز گزارش‌دهی (Reporting)
یک فایل `REPORT.md` در پوشه نسخه جدید ایجاد کنید (به زبان فارسی). ساختار گزارش باید شامل موارد زیر باشد:
1.  **مقدمه:** وضعیت کلی و نسخه لاراول.
2.  **تحلیل تغییرات:** چه چیزی نسبت به نسخه قبل عوض شده و آیا بهبود بوده یا پسرفت.
3.  **وضعیت باگ‌های قبلی:** کدام باگ‌ها رفع شده و کدام باقی مانده‌اند.
4.  **آسیب‌پذیری‌های جدید (Security Findings):** دسته‌بندی شده به Critical, High, Medium.
5.  **ایرادات منطقی (Logic Flaws):** مشکلات ساختاری و بیزنس لاجیک.
6.  **چک‌لیست توسعه‌دهنده:** لیست وظایف برای رفع اشکالات.

---

## نمونه پرامپت‌ها برای جولز (Prompts)

*   "جولز، نسخه `REV06` را با `REV05` مقایسه کن و لیست تمام فایل‌های تغییر یافته را بده. سپس تمرکز کن روی کنترلرهایی که تغییر کرده‌اند و ببین آیا باگ Mass Assignment رفع شده است؟"
*   "جولز، تمام فایل‌های Blade را اسکن کن و ببین آیا فرمی وجود دارد که Action آن به کنترلر اشتباهی اشاره کند؟"
*   "جولز، سعی کن `php artisan serve` را اجرا کنی و اگر موفق شدی، یک درخواست POST به `/login` بفرست و ببین چه پاسخی می‌گیری."

---
*این دستورالعمل در تاریخ {{DATE}} توسط جولز به‌روزرسانی شد تا اسکن کامل و دقیق پروژه را تضمین کند.*
