# ฺฏุฒุงุฑุด ุชุญูู ุงููุช ู ูู ูพุฑูฺู (REV06)

**ุชุงุฑุฎ ฺฏุฒุงุฑุด:** {{DATE}}
**ุชูู ฺฉููุฏู:** ุฌููุฒ (Jules)
**ูุณุฎู ููุฑุฏ ุจุฑุฑุณ:** REV06

---

## ฑ. ููุฏูู ู ุฎูุงุตู ูุถุนุช
ูุณุฎู `REV06` ูพุฑูฺู ุจุง ุชูุฑฺฉุฒ ุจุฑ ุฑูุน ุจุงฺฏโูุง ุงููุช ู ููุทู ฺฏุฒุงุฑุด ุดุฏู ุฏุฑ `REV05` ููุชุดุฑ ุดุฏู ุงุณุช. ุชุบุฑุงุช ฺฏุณุชุฑุฏูโุง ุฏุฑ ูุงู ฺฉูุชุฑูุฑูุง ู ุฏุฑุฎูุงุณุชโูุง (Form Requests) ุงุนูุงู ุดุฏู ุงุณุช ุชุง ูุฑูุฏโูุง ุงุนุชุจุงุฑุณูุฌ ุดููุฏ. ููฺูู ุจุฑุฎ ูฺฺฏโูุง ูุงุงูู ุญุฐู ุง ุจุงุฒููุณ ุดุฏูโุงูุฏ.

ุจุง ูุฌูุฏ ูพุดุฑูุชโูุง ฺุดูฺฏุฑุ ูููุฒ ุจุฑุฎ ููุงุฑุฏ ูุงุฒููุฏ ุชูุฌู ูุณุชูุฏ ู ฺฉ ุขุณุจโูพุฐุฑ ุจุญุฑุงู ุฏุฑ ุจุฎุด ูุฏุฑุช ูุธุงู (Task Manager) ุจุงู ูุงูุฏู ุงุณุช.

---

## ฒ. ุชุญูู ุชุบุฑุงุช (Diff Analysis: REV05 vs REV06)

### โ ุงุตูุงุญุงุช ุงูุฌุงู ุดุฏู (Verified Fixes)
1.  **ุญุฐู ุฏฺฉูู ุญุฐู ูพุฑุฏุงุฎุช:** ูุดฺฉู ุงุฑุฌุงุน ุงุดุชุจุงู ุฏฺฉูู ุญุฐู ุฏุฑ ูุณุช ูพุฑุฏุงุฎุชโูุง ุจู ฺฉูุชุฑูุฑ ูพุดุชุจุงู (ฺฉู ุจุงุนุซ ุญุฐู ุชฺฉุชโูุง ูโุดุฏ) ุจุง ุญุฐู ฺฉุงูู ุฏฺฉูู ุญุฐู ู ุจุงุฒููุณ ุฌุฏูู ููุงุดุ ุจุฑุทุฑู ุดุฏู ุงุณุช.
2.  **ุจูุจูุฏ ุงุญุฑุงุฒ ููุช:**
    *   ุงุณุชูุงุฏู ุงุฒ `rand()` ุจุง `random_int()` ู `Str::random()` ุฌุงฺฏุฒู ุดุฏู ุงุณุช.
    *   ุฏุฑ `UserController`ุ ุฏุณุชูุฑุงุช ูุฎุฑุจ ูพุงฺฉุณุงุฒ ฺฉุด (`Artisan::call`) ุงุฒ ูุชุฏ ุฎุฑูุฌ ุญุฐู ุดุฏูโุงูุฏ.
    *   ููุทู ุงููุถุง ฺฉุฏ ุชุงุฏ ููุจุงู (120 ุซุงูู) ุงุถุงูู ุดุฏู ุงุณุช.
3.  **ูุฏุฑุช Secrets:** ูุงู `docker-compose.yml` ฺฉู ุญุงู ุงุทูุงุนุงุช ุญุณุงุณ ุจูุฏุ ุงุฒ ูุฎุฒู ุญุฐู ุดุฏู ู ุจู `.gitignore` ุงุถุงูู ุดุฏู ุงุณุช.
4.  **ููุงุจูู ุจุง Mass Assignment (ุจุฎุด):**
    *   ุฏุฑ ุงฺฉุซุฑ ฺฉูุชุฑูุฑูุง (ูุงููุฏ `WorkPackageManagerController`, `UsersController`) ุงุณุชูุงุฏู ุงุฒ `$request->all()` ุจุง `$request->validated()` ุง ููุฏุงุฑุฏู ุฏุณุช ุฌุงฺฏุฒู ุดุฏู ุงุณุช.
    *   ููุฏ `role` ุงุฒ `$fillable` ูุฏู `Users` ุญุฐู ุดุฏู ุงุณุช.
5.  **ุงุนุชุจุงุฑุณูุฌ ุขูพููุฏ ูุงู (ุฏุฑ ุณุทุญ ุงุณุชูุงุฏู):** ุฏุฑ ุงฺฉุซุฑ ููุงุท ฺฉู ุงุฒ `FileLibraryController::upload` ุงุณุชูุงุฏู ูโุดุฏ (ูุซู `FreelancerOffer`, `WorkPackageRequest`)ุ ุงุนุชุจุงุฑุณูุฌ `mimes` ุจู ุฏุฑุฎูุงุณุชโูุง ุงุถุงูู ุดุฏู ุงุณุช.

---

## ณ. ุงูุชูโูุง ุงููุช ุฌุฏุฏ (Security Findings)

### ๐ด ููุงุฑุฏ ุจุญุฑุงู (Critical)

#### ฑ. ุขุณุจโูพุฐุฑ ุขูพููุฏ ูุงู ุฏุฑ ูพุดุฑูุช ูุธุงู (Missed File Validation)
ุจุง ูุฌูุฏ ุงูฺฉู ุงฺฉุซุฑ ุขูพููุฏูุง ุงูู ุดุฏูโุงูุฏุ ุฏุฑ ุจุฎุด ุซุจุช ูพุดุฑูุช ูุธูู (`WorkPackageTaskManagerAPIController::progressStore`) ู ุฏุฑุฎูุงุณุช ูุฑุจูุทู (`WorkPackageProgressRequest`)ุ ุงุนุชุจุงุฑุณูุฌ ููุน ูุงู (MIME Type) ูุฑุงููุด ุดุฏู ุงุณุช.
*   **ูุญู ูููุน:** `Modules/WorkPackageTaskManager/Http/Requests/WorkPackageProgressRequest.php`
*   **ฺฉุฏ ูุนู:** `'attachment' => 'required|file|max:10240'`
*   **ุฑุณฺฉ:** ุงูฺฉุงู ุขูพููุฏ ุดู PHP ู ุงุฌุฑุง ฺฉุฏ ูุฎุฑุจ (RCE).
*   **ูุถุนุช:** โ ุฑูุน ูุดุฏู (Regression/Missed).

#### ฒ. ุนุฏู ุงุนุชุจุงุฑุณูุฌ ุฏุงุฎู ุฏุฑ ฺฉุชุงุจุฎุงูู ุขูพููุฏ (Defense in Depth)
ฺฉูุงุณ `FileLibraryController::upload` ููฺูุงู ูฺ ุงุนุชุจุงุฑุณูุฌ ุฏุงุฎู ุงูุฌุงู ููโุฏูุฏ ู ุตุฑูุงู ูุงู ูุฑูุฏ ุฑุง ุฐุฎุฑู ูโฺฉูุฏ. ุงููุช ูุนู ูุงุจุณุชู ุจู ุงู ุงุณุช ฺฉู *ุชูุงู* ูุฑุงุฎูุงูโฺฉููุฏูโูุง ูุจู ุงุฒ ุตุฏุง ุฒุฏู ุงู ูุชุฏุ ูุงู ุฑุง ุงุนุชุจุงุฑุณูุฌ ฺฉููุฏ. ุงฺฏุฑ ุฏุฑ ุขูุฏู ุชูุณุนูโุฏููุฏูโุง ูุฑุงููุด ฺฉูุฏ ุงุนุชุจุงุฑุณูุฌ ุฑุง ุฏุฑ ฺฉูุชุฑูุฑ ุงุถุงูู ฺฉูุฏุ ุณุณุชู ุขุณุจโูพุฐุฑ ูโุดูุฏ.
*   **ุชูุตู:** ููุทู ุจุฑุฑุณ ูพุณููุฏ ูุงู ุจุงุฏ ุจู ุฏุฑูู ุฎูุฏ ูุชุฏ `upload` ููุชูู ุดูุฏ.

#### ณ. ุฎุทุฑ Mass Assignment ุฏุฑ ูุฏูโูุง ุจุงูโูุงูุฏู
ูููุฒ ููุฏูุง ุญุณุงุณ ุฏุฑ `$fillable` ุจุฑุฎ ูุฏูโูุง ูุฌูุฏ ุฏุงุฑูุฏุ ูุฑฺูุฏ ุฏุฑ ฺฉูุชุฑูุฑูุง ูุนู ูุฏุฑุช ุดุฏูโุงูุฏุ ุงูุง ุฑุณฺฉ ุจุงูููู ุจุงู ุงุณุช.
*   **WorkPackage:** ููุฏูุง `uid`, `status`, `published_at` ููฺูุงู ุฏุฑ `$fillable` ูุณุชูุฏ.
*   **SupportSystem:** ููุฏูุง `uid`, `status`, `created_by` ููฺูุงู ุฏุฑ `$fillable` ูุณุชูุฏ.
*   **ูฺฉุชู ูุซุจุช:** ุฏุฑ ฺฉูุชุฑูุฑูุง ูุฑุจูุทู (`WorkPackageManagerController` ู `SupportSystemController`) ููุงุฏุฑ `uid` ู `status` ุจู ุตูุฑุช ุฏุณุช ุณุช ูโุดููุฏ ู ุงุฒ `$request->validated()` ุงุณุชูุงุฏู ุดุฏู ุงุณุช ฺฉู ุฎุทุฑ ุจูุฑูโุจุฑุฏุงุฑ ูุณุชูู ุฑุง ุงุฒ ุจู ูโุจุฑุฏุ ุงูุง ุงุตูุงุญ ูุฏูโูุง ุจุฑุง ุงููุช ุจููุฏูุฏุช ุชูุตู ูโุดูุฏ.

### ๐ ููุงุฑุฏ ููู (High)

#### ด. ุงุญุชูุงู ุฎุทุง ุฏุฑ TaskChatController
ุฏุฑ `Modules/WorkPackageTaskManager/Http/Controllers/TaskChatController.php` ูุชุฏ `store` (ุง `taskCommentStore`) ุงุฒ `$request->validated()` ุงุณุชูุงุฏู ูโฺฉูุฏ. ุงฺฏุฑ ุงู ูุชุฏ ุงุฒ ฺฉ `FormRequest` ุงุฎุชุตุงุต ุงุณุชูุงุฏู ูฺฉูุฏ ู ูุณุชููุงู `Request` ูุงุฑุงูู ุจุงุดุฏุ ูุฑุงุฎูุงู `validated()` ุจุฏูู ูุฑุงุฎูุงู ูุจู `validate()` ููฺฉู ุงุณุช ุจุงุนุซ ุฎุทุง ุณุณุชู ุดูุฏ (ูุฑฺูุฏ ุขุณุจโูพุฐุฑ ุงููุช ูุณุชูู ูุณุช).
*   **ุจุฑูุฒุฑุณุงู:** ุฏุฑ ุจุฑุฑุณ ฺฉุฏ `REV06` ูุดุฎุต ุดุฏ ฺฉู `taskCommentStore` ุงุฒ `WorkPackageChatRequest` ุงุณุชูุงุฏู ูโฺฉูุฏ ฺฉู ุตุญุญ ุงุณุช. ุงูุง ูุชุฏ `store` ุฏุฑ ูุงู `TaskChatController` ูุณุฎู `REV05` ูุฌูุฏ ุฏุงุดุช ฺฉู ุฏุฑ `REV06` ุจู `taskCommentStore` ุชุบุฑ ูุงู ุฏุงุฏู ุง ุฑูฺฉุชูุฑ ุดุฏู ุงุณุช. ุจู ูุธุฑ ูโุฑุณุฏ ุงู ููุฑุฏ ุฑูุน ุดุฏู ุงุณุช.

---

## ด. ฺฺฉโูุณุช ุงุตูุงุญุงุช ุจุฑุง ุชูุณุนูโุฏููุฏู (Developer Checklist)

1.  [ ] **ููุฑ:** ุงุตูุงุญ `Modules/WorkPackageTaskManager/Http/Requests/WorkPackageProgressRequest.php` ู ุงูุฒูุฏู `mimes:jpg,jpeg,png,pdf,doc,docx,zip`.
2.  [ ] **ููู:** ุงูุชูุงู ููุทู ุงุนุชุจุงุฑุณูุฌ ูพุณููุฏ ูุงู ุจู ุฏุฑูู `FileLibraryController::upload` ุชุง ุจู ุนููุงู ูุงู ุฏูุงุน ุฏูู ุนูู ฺฉูุฏ.
3.  [ ] **ุจูุจูุฏ:** ุญุฐู ููุฏูุง ุญุณุงุณ (`uid`, `status`, `published_at`) ุงุฒ `$fillable` ูุฏูโูุง `WorkPackage` ู `SupportSystem`.
4.  [ ] **ุชุณุช:** ุจุฑุฑุณ ุงุฌุฑุง ูพุฑูฺู. ุฏุฑ ุญุงู ุญุงุถุฑ ุงูฺฉุงู ุงุฌุฑุง ูพุฑูฺู ุจุง ุฏุณุชูุฑุงุช ุงุณุชุงูุฏุงุฑุฏ (`php artisan serve` ุง `docker-compose`) ูุฑุงูู ูุดุฏ (ูุดฺฉูุงุช ูุญุท ุง ูุงุจุณุชฺฏ). ุงุทููุงู ุญุงุตู ฺฉูุฏ ฺฉู ูพุฑูฺู ูุงุจู ุงุณุชูุฑุงุฑ ุงุณุช.

---
**ุชุงุฏ ููุง:** ูุณุฎู `REV06` ูพุดุฑูุช ูุงุจู ุชูุฌู ุฏุงุดุชู ู ุงฺฉุซุฑ ุญูุฑูโูุง ุงููุช ูุณุฎู ูุจู ุฑุง ุจุณุชู ุงุณุช. ุจุง ุฑูุน ููุฑุฏ ุดูุงุฑู ฑ (ุขูพููุฏ ุฏุฑ Progress)ุ ุงููุช ูพุฑูฺู ุจู ุณุทุญ ูุงุจู ูุจูู ูโุฑุณุฏ.
